class Stats{constructor(){let t=this;this.setDefaultCurrency(),$("#menu-stats").on("click",(function(t){t.preventDefault(),$("#modal-stats").modal("show")})),$("#stats-currency").on("change",(function(){t.loadStats()})),$("#modal-stats").on("show.bs.modal",(function(){t.loadStats()}))}setDefaultCurrency(){var t=navigator.language||navigator.userLanguage||"en-US",a={de:"EUR",fr:"EUR",es:"EUR",it:"EUR",nl:"EUR","en-GB":"GBP","en-US":"USD",ja:"JPY",zh:"CNY",ru:"RUB",pl:"PLN",tr:"TRY",br:"BRL",pt:"EUR",ch:"CHF",se:"SEK",no:"NOK",dk:"DKK"},e=a[t]||a[t.split("-")[0]]||"USD";$('#stats-currency option[value="'+e+'"]').length>0?$("#stats-currency").val(e):$("#stats-currency").val("USD")}loadStats(){var t=$("#stats-currency").val()||"USD";$("#modal-stats .loader").removeClass("d-none"),$("#stats-content").addClass("d-none"),$.ajax({url:"./json.stats?currency="+t,type:"GET",dataType:"json",success:function(t){if(200===t.status&&t.data){var a=t.data;if($("#monthly-currency").text(a.currency),$("#yearly-currency").text(a.currency),$("#total-machines").text(a.total_machines),$("#monthly-cost").text(a.monthly_cost),$("#yearly-cost").text(a.yearly_cost),a.by_provider&&a.by_provider.length>0){var e="",s=0;$.each(a.by_provider,(function(t,a){s+=parseInt(a.count)})),$.each(a.by_provider,(function(t,a){var r=(a.count/s*100).toFixed(1);e+="<tr><td>"+(a.name||"Unknown")+'</td><td class="text-end">'+a.count+'</td><td><div class="progress" style="height: 20px;"><div class="progress-bar bg-primary" role="progressbar" style="width: '+r+'%" aria-valuenow="'+a.count+'" aria-valuemin="0" aria-valuemax="'+s+'">'+r+"%</div></div></td></tr>"})),$("#provider-tbody").html(e)}else $("#provider-tbody").html('<tr><td colspan="3" class="text-center text-muted">No data</td></tr>');if(a.by_country&&a.by_country.length>0){var r="",n=0;$.each(a.by_country,(function(t,a){n+=parseInt(a.count)})),$.each(a.by_country,(function(t,a){var e=(a.count/n*100).toFixed(1),s=a.country_code?"fi fi-"+a.country_code.toLowerCase():"";r+='<tr><td><span class="'+s+' me-2"></span>'+(a.country_name||"Unknown")+'</td><td class="text-end">'+a.count+'</td><td><div class="progress" style="height: 20px;"><div class="progress-bar bg-success" role="progressbar" style="width: '+e+'%" aria-valuenow="'+a.count+'" aria-valuemin="0" aria-valuemax="'+n+'">'+e+"%</div></div></td></tr>"})),$("#country-tbody").html(r)}else $("#country-tbody").html('<tr><td colspan="3" class="text-center text-muted">No data</td></tr>');$("#modal-stats .loader").addClass("d-none"),$("#stats-content").removeClass("d-none")}},error:function(){$("#modal-stats .loader").addClass("d-none"),alert("Connection lost, please try again.")}})}}
