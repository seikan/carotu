class Stats{constructor(){let t=this;this.setDefaultCurrency(),$("#menu-stats").on("click",(function(t){t.preventDefault(),$("#modal-stats").modal("show")})),$("#stats-currency").on("change",(function(){t.loadStats()})),$("#modal-stats").on("show.bs.modal",(function(){t.loadStats()})),$("#modal-stats").on("hide.bs.modal",(function(){$(this).find(":focus").blur()}))}setDefaultCurrency(){var t=navigator.language||navigator.userLanguage||"en-US",s={de:"EUR",fr:"EUR",es:"EUR",it:"EUR",nl:"EUR","en-GB":"GBP","en-US":"USD",ja:"JPY",zh:"CNY",ru:"RUB",pl:"PLN",tr:"TRY",br:"BRL",pt:"EUR",ch:"CHF",se:"SEK",no:"NOK",dk:"DKK"},a=s[t]||s[t.split("-")[0]]||"USD";$('#stats-currency option[value="'+a+'"]').length>0?$("#stats-currency").val(a):$("#stats-currency").val("USD")}loadStats(){var t=$("#stats-currency").val()||"USD";$("#modal-stats .loader").removeClass("d-none"),$("#stats-content").addClass("d-none"),$.ajax({url:"./json.stats?currency="+t,type:"GET",dataType:"json",success:function(t){if(200===t.status&&t.data){var s=t.data;if($("#monthly-currency").text(s.currency),$("#yearly-currency").text(s.currency),$("#total-machines").text(s.total_machines),$("#monthly-cost").text(s.monthly_cost),$("#yearly-cost").text(s.yearly_cost),$("#total-cores").text(s.total_cores),$("#total-memory").text((s.total_memory/1024).toFixed(0)+" GB"),$("#total-disk").text((s.total_disk/1024/1024).toFixed(0)+" TB"),$("#total-bandwidth").text((s.total_bandwidth/1024/1024).toFixed(0)+" TB"),s.by_provider&&s.by_provider.length>0){var a="",e=0,o=0;$.each(s.by_provider,(function(t,s){e+=parseInt(s.count),o+=parseFloat(s.cost)})),$.each(s.by_provider,(function(t,r){var n=(r.count/e*100).toFixed(1),l=(parseFloat(r.cost)/o*100).toFixed(1);a+="<tr><td>"+(r.name||"Unknown")+'</td><td class="text-center">'+r.count+'</td><td class="text-center text-muted">'+r.cost+" <small>"+s.currency+'</small></td><td><div class="mb-1"><small class="text-muted">Machines: '+n+'%</small></div><div class="progress mb-1" style="height: 12px;"><div class="progress-bar bg-primary" role="progressbar" style="width: '+n+'%"></div></div><div class="mb-1"><small class="text-muted">Cost: '+l+'%</small></div><div class="progress mb-1" style="height: 12px;"><div class="progress-bar bg-info" role="progressbar" style="width: '+l+'%"></div></div></td></tr>'})),$("#provider-tbody").html(a)}else $("#provider-tbody").html('<tr><td colspan="4" class="text-center text-muted">No data</td></tr>');if(s.by_country&&s.by_country.length>0){var r="",n=0;$.each(s.by_country,(function(t,s){n+=parseInt(s.count)})),$.each(s.by_country,(function(t,s){var a=(s.count/n*100).toFixed(1),e=s.country_code?"fi fi-"+s.country_code.toLowerCase():"";r+='<tr><td><span class="'+e+' me-2"></span>'+(s.country_name||"Unknown")+'</td><td class="text-end">'+s.count+'</td><td><div class="progress" style="height: 20px;"><div class="progress-bar bg-success" role="progressbar" style="width: '+a+'%" aria-valuenow="'+s.count+'" aria-valuemin="0" aria-valuemax="'+n+'">'+a+"%</div></div></td></tr>"})),$("#country-tbody").html(r)}else $("#country-tbody").html('<tr><td colspan="3" class="text-center text-muted">No data</td></tr>');$("#modal-stats .loader").addClass("d-none"),$("#stats-content").removeClass("d-none")}},error:function(){$("#modal-stats .loader").addClass("d-none"),alert("Connection lost, please try again.")}})}}